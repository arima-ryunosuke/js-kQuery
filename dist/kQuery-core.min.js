(()=>{var Y=Object.defineProperty;var h=(n,e)=>Y(n,"name",{value:e,configurable:!0});var ee=(n,e)=>{for(var r in e)Y(n,r,{get:e[r],enumerable:!0})};var F={};ee(F,{$CSSRuleList:()=>re,$FileList:()=>G,$NodeList:()=>k,AsyncFunction:()=>K,AsyncGeneratorFunction:()=>ne,Collection:()=>x,Configuration:()=>P,CookieObserver:()=>z,CustomEvent:()=>j,Dictionary:()=>Z,F:()=>u,FileReader:()=>B,GeneratorFunction:()=>te,IntersectionObserver:()=>U,Logger:()=>y,MutationObserver:()=>R,Nullable:()=>v,ObjectStorage:()=>A,Options:()=>I,Promise:()=>N,Proxy:()=>S,ResizeObserver:()=>q,Timer:()=>H,TimerObserver:()=>C,Vector2:()=>W,WeakMap:()=>E});var b=globalThis,K=(async()=>{}).constructor,te=function*(){}.constructor,ne=async function*(){}.constructor,v=h(function(e){return e==null},"Nullable"),Z=h(function(e){return typeof e!="object"?!1:!Object.hasOwn(e,"entries")&&typeof e.entries=="function"||!Object.hasOwn(e,"keys")&&typeof e.keys=="function"||!Object.hasOwn(e,"values")&&typeof e.values=="function"||!Object.hasOwn(e,"length")&&"length"in e?!0:!(Symbol.iterator in e)},"Dictionary"),k=h(function(){return[NodeList.name,HTMLCollection.name]},"$NodeList"),re=h(function(){return[CSSRuleList.name]},"$CSSRuleList"),G=h(function(){return[FileList.name]},"$FileList"),u={anyIsPrimitive(n,...e){if(n==null)return!0;for(let r of e){if(r===Object){if(u.objectIsPlain(n))return!0;continue}if(n instanceof r)return!0}return!["object","function"].includes(typeof n)},anyIsStringable(n){return u.anyIsPrimitive(n)?!0:n?.toString&&n.toString!==Object.prototype.toString},stringToKebabCase(n){return(""+n).replaceAll(/([A-Z])/g,(...e)=>"-"+e[1].toLowerCase())},stringToPascalCase(n,e){e??="-";let r=new RegExp(`(\\${e}([a-z]))`,"ig");return(""+n).replaceAll(r,(...t)=>t[2].toUpperCase())},stringEscape(n,e){let r={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"};switch(n+="",e){default:throw new Error(`${e} is undefied`);case"attr-name":{let t=document.createElement("div");return t.setAttribute(n,""),t.attributes[0].name}case"attr-value":return n.replace(/[&"]/g,t=>r[t]);case"content":return n.replace(/[&<>]/g,t=>r[t]);case"html":return n.replace(/[&"'<>]/g,t=>r[t]);case"regex":return n.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");case"css":case"selector":return CSS.escape(n)}},stringQuote(n,e){switch(n+="",e){default:throw new Error(`${e} is undefied`);case"css-url":return n.includes('"')?n.includes("'")?n.replaceAll(/([ '"()])/g,"\\$1"):"'"+n+"'":'"'+n+'"'}},stringUnquote(n,e){switch(n+="",e){default:throw new Error(`${e} is undefied`);case"css-url":return n.at(0)==='"'&&n.at(-1)==='"'?n.slice(1,-1):n.at(0)==="'"&&n.at(-1)==="'"?n.slice(1,-1).replaceAll(/\\'/g,"'"):n.replaceAll(/\\([ '"()])/g,"$1")}},stringIsNaN(n){return Number.isNaN(parseFloat(n))},stringRender:function(){let n={};return function(e,r,t=null){let o=h((a,...l)=>l.map(c=>t==null||c instanceof String?c:t(c)).map((c,d)=>a[d]+c).concat(a.slice(l.length)).join(""),"tagFunction"),s=`${t}\`${e}\``,i=n[s]??=new Function("",`return globalThis.$__internalTagFunctions.at(-1)\`${e}\`;`);b.$__internalTagFunctions??=[],b.$__internalTagFunctions.push(o);try{return i.call(r)}finally{b.$__internalTagFunctions.pop()}}}(),objectId:function(){let n=new b.WeakMap,e=0;return function(r){return r===null||typeof r!="object"?null:(n.has(r)||n.set(r,++e),n.get(r))}}(),objectFinalize:function(){let n=new FinalizationRegistry(e=>e());return function(e,r){n.register(e,r,e)}}(),objectIsPlain(n){return n==null||typeof n!="object"?!1:n.constructor===Object||n.constructor==null},objectIsArrayLike(n,e=!0){if(n instanceof Array)return!0;if(n==null||typeof n!="object")return!1;let r=Object.keys(n);if(!("length"in n)&&r.length===0)return!1;let t=n.length??(e?null:r.length);if(t==null)return!1;let o=r.indexOf("length");if(o!==-1&&r.splice(o,1),r.length!==+t)return!1;let s=r.map(i=>+i);for(let i=0;i<t;i++)if(s[i]!==i)return!1;return!0},objectToAttributes(n,e=""){let r={};for(let[t,o]of u.objectToEntries(n)){let s=e?`${e}-${t}`:t;if(s.startsWith("data-")&&(s=u.stringToKebabCase(s)),s==="style"&&u.objectIsPlain(o)){let i=[];for(let[a,l]of u.objectToEntries(o))i.push(u.stringToKebabCase(a)+":"+l);i.length&&(r[s]=i.join(";")+";")}else if(s==="class"){let i=[];for(let[a,l]of u.objectToEntries(u.objectToClasses(o)))l&&i.push(a);i.length&&(r[s]=i.join(" "))}else u.objectIsPlain(o)?Object.assign(r,u.objectToAttributes(o,t)):r[s]=o}return r},objectToClasses(n){let e=h(function(t){return(""+t).split(" ").filter(o=>o.length)},"normalizeToken"),r={};if(n instanceof Array)for(let t of n)Object.assign(r,u.objectToClasses(t));else if(u.objectIsPlain(n))for(let[t,o]of u.objectToEntries(n))for(let s of e(t))r[e(s)]=!!o;else for(let t of e(n))r[e(t)]=!0;return r},objectToDataset(n,e=""){let r={};for(let[t,o]of u.objectToEntries(n)){let s=u.stringToKebabCase(e?`${e}-${t}`:t);if(u.objectIsPlain(o)||o instanceof Array){for(let[i,a]of u.objectToEntries(u.objectToDataset(o,s)))r[i]=a;o instanceof Array&&(r[s+"-length"]=o.length)}else r[s]=o}return r},objectToEntries(n){return n instanceof NamedNodeMap?Array.from(n).map(e=>[e.name,e.value]):n instanceof CSSStyleDeclaration?Array.from(n).map(e=>[e,n[e]]):!Object.hasOwn(n,"entries")&&typeof n.entries=="function"?[...n.entries()]:!Object.hasOwn(n,"keys")&&typeof n.keys=="function"?[...Array.from(n.keys()).flatMap(e=>[[e,n[e]]])]:!Object.hasOwn(n,"values")&&typeof n.values=="function"?[...Array.from(n.values()).entries()]:!Object.hasOwn(n,"length")&&"length"in n?[...Array.from(n).entries()]:(Symbol.iterator in n,Object.entries(n))},objectToArrayEntries(n,e){let r=[];for(let[t,o]of u.objectToEntries(n)){let s=e?`${e}[${t}]`:t;if(o instanceof Array)for(let[i,a]of o.entries())u.objectIsPlain(a)?r=r.concat(u.objectToArrayEntries(a,`${s}[${i}]`)):r.push([`${s}[]`,a]);else u.objectIsPlain(o)?r=r.concat(u.objectToArrayEntries(o,s)):r.push([s,o])}return r},objectDeleteProperties(n,e){let r=Object.create(null);for(let[t,o]of u.objectToEntries(e)){let s=n[t]??o;delete n[t],o!=null&&(s=(()=>{switch(typeof o){case"boolean":return!!s;case"number":return+s;case"bigint":return 0n+s;case"string":return""+s;default:return o instanceof Array?s instanceof Array?s:[s]:s}})()),r[t]=s}return r},objectJoin(n,e,r="="){let t=[];for(let[o,s]of u.objectToEntries(n))if(s!==void 0)if(u.objectIsPlain(s)&&(s=u.objectJoin(s,e,r)),r instanceof Function){let i=r(s,o);i&&t.push(i)}else t.push(`${o}${r}${s}`);return t.join(e)},objectWalkRecursive(n,e){let r=e instanceof K,t=[];for(let[o,s]of u.objectToEntries(n)){let i=h(l=>n[o]=l,"assign"),a=s instanceof Array||u.objectIsPlain(s)?u.objectWalkRecursive(s,e):e(s,o,n);r?t.push(a.then(i)):i(a)}return r?N.all(t).then(o=>n):n},iterableToNodeList(n){n instanceof NodeList&&y.instance.notice("meaningless call to iterableToNodeList");let e=0,r={};for(let t of n)r[e++]={value:t,configurable:!1,writable:!1,enumerable:!0};return r.length={value:e,configurable:!1,writable:!1,enumerable:!1},Object.create(NodeList.prototype,r)},arrayLikeToArrayRecursive(n,e=!0){for(let[r,t]of u.objectToEntries(n))typeof t=="object"&&(n[r]=u.arrayLikeToArrayRecursive(t,e));return u.objectIsArrayLike(n,e)&&(e||"length"in n?n=Array.from(n):n=Object.values(n)),n},entriesToObject(n,e){let r={};for(let[t,o]of n)t.reduce((s,i,a)=>s[i]??=a+1 in t?{}:o,r);return e!=null?u.arrayLikeToArrayRecursive(r,e):r},functionIsNative(n){return Function.prototype.toString.call(n).slice(-15,-2)==="[native code]"},functionToCallbackable(n,e,...r){return function(...t){for(let[o,s]of t.entries()){let i=typeof s=="function"&&!(s instanceof S)?s:null;if(i&&(t[o]=i.call(e,...r),t[o]===void 0))return}return n.call(this,...t)}},...function(){let n=h(function(t,o){return t??={},t instanceof Headers||(t=new Headers(t)),window.location.origin===o.origin&&t.append("X-Requested-With","XMLHttpRequest"),t},"handleHeaders"),e=h(function(t,o){if(t.body){if((t.method??"GET").toUpperCase()==="GET")typeof t.body=="string"||t.body instanceof URLSearchParams||u.objectIsPlain(t.body)?o.searchParams.$assign(new URLSearchParams(t.body)):y.instance.error("GET, but a body is specified. fetch silently ignores the body"),delete t.body;else if(u.objectIsPlain(t.body))if(t.headers.get("content-type")?.startsWith("application/json"))t.body=JSON.stringify(t.body);else{let s=u.objectToArrayEntries(t.body);s.map(([i,a])=>a).find(i=>i instanceof Blob)?t.body=new FormData:t.body=new URLSearchParams;for(let[i,a]of s)t.body.append(i,a)}return t.body}},"handleBody"),r=h(function(t,o){let a=Math.floor(Math.random()*1e3);if(o<3){if(t instanceof Response&&t.headers.has("retry-after")){let l=t.headers.get("retry-after");return isNaN(l)?Math.max(1e3,new Date(l).getTime()-Date.now())+a:l*1e3+a}if(t instanceof Error||[503,504].includes(t.status))return Math.min(30*1e3,2**o*1e3)+a}return 0},"handleRetry");return{async fetch(t,o={}){t=new URL(t,window.location.href);let{ok:s,timeout:i,retryer:a}=u.objectDeleteProperties(o,{ok:!1,timeout:void 0,retryer:r});if(i){let c=new AbortController;setTimeout(()=>c.abort(),i),o.signal?o.signal=AbortSignal.any([o.signal,c.signal]):o.signal=c.signal}o.headers=n(o.headers,t),o.body=e(o,t);let l=0;for(;;){let c;try{c=await b.fetch(t,o)}catch(f){c=f}let d=a(c,l++);if(d){let f=c instanceof Error?c.message:`${c.status}: ${c.statusText}`;y.instance.warn(`retry ${t} ${l} ${f}, after ${d}ms`),await H.wait(d);continue}if(c instanceof Error)throw c.cause??={},c.cause.retryCount=l-1,c;if(!s&&!c.ok)throw c.retryCount=l-1,new Error(`${c.status}: ${c.statusText}`,{cause:c});return c}},async xhr(t,o){t=new URL(t,window.location.href),o=Object.assign({method:"GET",headers:{},body:null,credentials:"same-origin",timeout:0,ok:!1,signal:null,progress:h(()=>null,"progress")},o),o.headers=n(o.headers,t),o.body=e(o,t);let s=new XMLHttpRequest;s.open(o.method.toUpperCase(),t,!0),s.timeout=o.timeout,s.withCredentials=(i=>{switch(i){case"omit":return!1;case"same-origin":return window.location.origin===t.origin;case"include":return!0}})(o.credentials),s.responseType="arraybuffer",o.signal&&o.signal.addEventListener("abort",()=>{s.abort()});for(let[i,a]of u.objectToEntries(o.headers))s.setRequestHeader(i,a);return s.send(o.body),new N((i,a)=>{let l=h(function(){let c=new Response(s.response,{status:s.status,statusText:s.statusText,headers:s.getAllResponseHeaders().split(/\r\n?/).reduce(function(d,f){if(f.trim()){let[m,p]=f.split(":");d.append(m.trim(),p.trim())}return d},new Headers)});return Object.defineProperties(c,{url:{get(){return s.responseURL}}})},"newResponse");s.addEventListener("readystatechange",function(){s.readyState===XMLHttpRequest.HEADERS_RECEIVED&&!o.ok&&!(200<=s.status&&s.status<300)&&a(new Error(`${s.status}: ${s.statusText}`,{cause:l()}))}),s.addEventListener("load",()=>{i(l())}),s.addEventListener("error",c=>{a(c)}),s.addEventListener("abort",c=>{a(c)}),s.addEventListener("timeout",c=>{a(c)}),s.upload.addEventListener("progress",c=>{o.progress(c,o.body)})})}}}()},P=class n{static{h(this,"Configuration")}static TRUES=Object.freeze(["true","yes","1"]);static instance;#e;constructor(e){n.instance=this,this.#e=e}configure(e,r=!1){for(let[t,o]of Object.entries(e)){if(r||this.#e[t]===void 0){this[t]=o;continue}typeof o=="boolean"?this[t]=n.TRUES.includes(this.#e[t]):typeof o=="number"?this[t]=+this.#e[t]:typeof o=="string"?this[t]=""+this.#e[t]:typeof o=="function"?this[t]=o(this.#e[t],t,this.#e):this[t]=JSON.parse(this.#e[t])}return this}},y=class n{static{h(this,"Logger")}static instance;static anyIsInstanceOf(e,r){return!!(e===r||v===r&&r(e)||Z===r&&r(e)||r===Object&&u.objectIsPlain(e)||r!==Object&&typeof r=="function"&&Object(e)instanceof r||r===Boolean&&u.anyIsPrimitive(e)||r===Number&&(Object(e)instanceof r||!isNaN(e))||r===String&&(Object(e)instanceof r||e?.toString&&e.toString!==Object.prototype.toString))}static anyToDisplayName(e){return e==null?""+e:typeof e=="function"?e.name??""+e:""+e}constructor(e,r,t,o){n.instance=this;let s=h(()=>null,"noop"),i=h(()=>s,"noop2");this.error=r<3?s:o.error.bind(this,t),this.warn=r<4?s:o.warn.bind(this,t),this.info=r<6?s:o.info.bind(this,t),this.debug=r<7?s:o.debug.bind(this,t),this.notice=r<5?s:e?o.warn.bind(this,t):o.info.bind(this,t),this.time=r<7?s:a=>o.time.call(this,`${t} ${a}`),this.timeEnd=r<7?s:a=>o.timeEnd.call(this,`${t} ${a}`),this.assert=e?(a,...l)=>{let c=l;return a instanceof Function&&(c=[""+a],a=a(...l)),o.assert.bind(this,a,t,...c)}:i,this.assertInstanceOf=e?(a,...l)=>{for(let c of l)if(n.anyIsInstanceOf(a,c))return s;return o.assert.bind(this,!1,t,`${n.anyToDisplayName(a)} type must be ${l.map(n.anyToDisplayName).join("|")}`)}:i,this.assertElementsInstanceOf=e?(a,...l)=>{for(let c of l)if(Object.values(a).every(d=>n.anyIsInstanceOf(d,c)))return s;return o.assert.bind(this,!1,t,`${n.anyToDisplayName(a)} type must be ${l.map(n.anyToDisplayName).join("|")}`)}:i,this.assertElementOf=e?(a,...l)=>{for(let c of l)if(c.includes(a))return s;return o.assert.bind(this,!1,t,`${n.anyToDisplayName(a)} must be one of ${l.map(n.anyToDisplayName).join("|")}`)}:i,this.assertElementsOf=e?(a,...l)=>{for(let c of l)if(Object.values(a).every(d=>c.includes(d)))return s;return o.assert.bind(this,!1,t,`${n.anyToDisplayName(a)} must be one of ${l.map(n.anyToDisplayName).join("|")}`)}:i}},x=class n extends null{static{h(this,"Collection")}constructor(e,r,t){t??=e;let o=Object.defineProperties(()=>{},{name:{value:`Collection of ${r}`},length:{value:e.length}});return P.instance.debug&&e.forEach((s,i)=>o[i]=s),new S(o,{has(s,i){return i in e?Reflect.has(e,i):(e.length===0&&y.instance.notice("Tried to manipulate empty list, but mostly a bug. Please check selectors etc. if not intended"),e.some(a=>Reflect.has(a,i)))},get(s,i){if(i in e)return Reflect.get(e,i);if(e.length===0&&y.instance.notice("Tried to manipulate empty list, but mostly a bug. Please check selectors etc. if not intended"),i===Symbol.toPrimitive)return l=>e.map(c=>u.anyIsPrimitive(c,Array)?c:Reflect.get(c,i)?.call(c,l)).join();let a=e.map(l=>u.anyIsPrimitive(l,Array)?l:Reflect.get(l,i));return a.every(l=>u.anyIsPrimitive(l,Object,Array))?a:new n(a,`${r}.${i}`,t)},set(s,i,a){return i in e?Reflect.set(e,i,a):(e.length===0&&y.instance.notice("Tried to manipulate empty list, but mostly a bug. Please check selectors etc. if not intended"),e.forEach((l,c)=>u.functionToCallbackable(d=>Reflect.set(l,i,d),l,t?.[c],c)(a)),!0)},deleteProperty(s,i){return i in e?Reflect.deleteProperty(e,i):(e.length===0&&y.instance.notice("Tried to manipulate empty list, but mostly a bug. Please check selectors etc. if not intended"),e.forEach(a=>Reflect.deleteProperty(a,i)),!0)},apply(s,i,a){if(e.length===0)return y.instance.notice("Tried to manipulate empty list, but mostly a bug. Please check selectors etc. if not intended"),[];if(e.some(l=>typeof l=="function")){let l=!1,c=!0,d=!0,f=!0,m=!1,p=e.map((w,L)=>{if(typeof w=="function"){if(w instanceof S&&a.length===0){l=!0;return}w instanceof S||(w.i=L);let g=Reflect.apply(w,i?.[L],a);return c=c&&g===void 0,d=d&&u.anyIsPrimitive(g,Object,Array),f=f&&g===t?.[L],m=m||g instanceof b.Promise,g}});return l?e:c?i:d?p:f?t:m?b.Promise.all(p):new n(p,`${r}()`,t)}if(a.length===0)return e;a.length,y.instance.error("apply called, but not a single case was executed",s)}})}},E=class{static{h(this,"WeakMap")}constructor(){this.map=new b.Map}has(e){return this.map.has(u.objectId(e))}get(e){return this.map.get(u.objectId(e))?.value}getOrSet(e,r){return this.has(e)||this.set(e,r(e)),this.get(e)}set(e,r){return this.map.set(u.objectId(e),{ref:new WeakRef(e),value:r})}reset(e,r){let t=this.get(e);return this.set(e,r(t)),t}delete(e){return this.map.delete(u.objectId(e))}clear(){return this.map.clear()}*entries(){for(let e of this.map.values()){let r=e.ref.deref();if(r===void 0){this.map.delete(r);continue}yield[r,e.value]}}get size(){return[...this.entries()].length}},A=class{static{h(this,"ObjectStorage")}constructor(){this.weakmap=new E}has(e,r){if(r==null)return this.weakmap.has(e);let t=this.weakmap.get(e)??{};return r in t}get(e,r){return r==null?this.weakmap.get(e)??{}:(this.weakmap.get(e)??{})?.[r]}getOrSet(e,r,t){return this.has(e,r)||this.set(e,r,t(e,r)),this.get(e,r)}set(e,r,t){if(r==null)return this.weakmap.set(e,t);let o=this.weakmap.get(e)??{};return o[r]=t,this.weakmap.set(e,o)}reset(e,r,t){let o=this.get(e,r);return this.set(e,r,t(o)),o}delete(e,r){if(r==null)return this.weakmap.delete(e);let t=this.weakmap.get(e)??{};return delete t[r],Object.keys(t).length?!1:this.weakmap.delete(e)}clear(){return this.weakmap.clear()}*entries(){yield*this.weakmap.entries()}get size(){return this.weakmap.size}},N=class n extends b.Promise{static{h(this,"Promise")}static resolvedReasonSymbol=Symbol("resolved");static async#e(e,r,t=null){y.instance.assertElementsInstanceOf(e,Function,K)(),t??=window.navigator.hardwareConcurrency;let o=u.objectToEntries(e).map(([a])=>a),s=e instanceof Array?new Array(e.length):{},i=0;return await n.all(Array.from({length:t}).map(async()=>{for(;;){let a=o[i++];if(!e[a])return;try{s[a]=await e[a](a)}catch(l){if(r)throw l;s[a]=l}}})),s}static async concurrencyAll(e,r=null){return n.#e(e,!0,r)}static async concurrencyAllSettled(e,r=null){return n.#e(e,!1,r)}constructor(e){let r,t;super((a,l)=>{r=a,t=l});let o=h(a=>{this.status="fulfilled",r(a)},"resolve2"),s=h(a=>{this.status="rejected",t(a)},"reject2"),i=new AbortController;i.signal.addEventListener("abort",a=>{a.target.reason===n.resolvedReasonSymbol?o(this.resolved):s(a.target.reason)}),e(o,s),this.controller=i,this.resolved=null,this.status="pending"}cancel(e){this.resolved=e,this.controller.abort(n.resolvedReasonSymbol)}abort(e){this.controller.abort(e)}},B=class extends b.FileReader{static{h(this,"FileReader")}promise(){return new N((e,r)=>{this.addEventListener("load",t=>e(t.target.result)),this.addEventListener("error",t=>r(t.target.error))})}},S=class n extends null{static{h(this,"Proxy")}static instances=new WeakSet;static[Symbol.hasInstance](e){return n.instances.has(e)}constructor(e,r){let t=new b.Proxy(e,r);return n.instances.add(t),t}},H=class extends EventTarget{static{h(this,"Timer")}constructor(){super(),this.id=null,this.millisecond=null}static wait(e){let r=new this;return new N((t,o)=>{r.addEventListener("alarm",s=>t(Date.now()-s.detail.time)),r.start(e)}).finally(()=>r.stop())}start(e,r=1){y.instance.assert(this.id===null)("Timer is started, please use restart"),this.millisecond=e;let t=h((o,s)=>{this.id=setTimeout(()=>{this.dispatchEvent(new j("alarm",{detail:{id:this.id,tick:o,time:s}})),o<r&&t(o+1,Date.now())},this.millisecond)},"start");t(1,Date.now())}restart(e,r){return this.stop(),this.start(e,r)}stop(){clearTimeout(this.id),this.id=null}},I=class n{static{h(this,"Options")}constructor(e,r=!1,t=!1){this.options=e,this.handleNull=r,this.handleUndefined=t}extends(e){return new n(Object.assign({},this.options,e),this.handleNull,this.handleUndefined)}merge(e){let r={};for(let t of Object.keys(this.options))this.handleNull&&t in e&&e[t]===null||this.handleUndefined&&t in e&&e[t]===void 0?r[t]=e[t]:r[t]=e[t]??this.options[t];return r}},C=class n{static{h(this,"TimerObserver")}static observers=new b.Set;static timer=new H;static defaultOptions=new I({interval:1e3});constructor(e,r={}){this.options=n.defaultOptions.merge(r),this.observedNodes=new A,this.callback=t=>{let o=[];for(let[s,i]of this.observedNodes.entries()){let a=this._data(s),l=this._compare(i.data,a);this.observedNodes.set(s,"data",a);for(let c of l)o.push(Object.assign(c,{target:s,time:t.timeStamp}))}for(let s of o)e(s,this.observedNodes.reset(s.target,"last",()=>s))},n.timer.addEventListener("alarm",this.callback)}_data(e){}_compare(e,r){}observe(e){this.observedNodes.set(e,"data",this._data(e)),n.timer.restart(Math.min(n.timer.millisecond??this.options.interval,this.options.interval),1/0),n.observers.add(this)}unobserve(e){this.observedNodes.delete(e),this.observedNodes.size===0&&this.disconnect()}disconnect(){this.observedNodes.clear(),n.timer.removeEventListener("alarm",this.callback),n.observers.delete(this),n.observers.size===0&&n.timer.stop()}entries(){return this.observedNodes.entries()}},z=class n extends C{static{h(this,"CookieObserver")}static defaultOptions=C.defaultOptions.extends({cookieName:void 0});static getOptionsKey(e){return JSON.stringify(this.defaultOptions.merge(e))}constructor(e,r={}){super(e,r),this.options=n.defaultOptions.merge(r)}_data(e){return{cookie:e.cookie,cookies:Object.fromEntries(e.cookie.split("; ").map(r=>r.split(/=(.*)/s).map(decodeURIComponent)))}}_compare(e,r){if(e.cookie===r.cookie)return[];let t=new Set;Object.keys(e.cookies).forEach(s=>t.add(s)),Object.keys(r.cookies).forEach(s=>t.add(s));let o=[];for(let s of t.values())if(this.options.cookieName==null||this.options.cookieName.includes(s)){let i=e.cookies[s],a=r.cookies[s];i!==a&&o.push({cookieName:s,oldValue:i,newValue:a})}return o}},R=class n extends b.MutationObserver{static{h(this,"MutationObserver")}static defaultOptions=new I({attributes:void 0,attributeFilter:void 0,attributeOldValue:void 0,characterData:void 0,characterDataOldValue:void 0,childList:void 0,subtree:void 0});static getOptionsKey(e){return JSON.stringify(this.defaultOptions.merge(e))}constructor(e,r={}){super(function(t){for(let o of t)e(o,this.observedNodes.reset(o.target,()=>o))}),this.options=n.defaultOptions.merge(r),this.observedNodes=new E}observe(e){return this.observedNodes.set(e,null),super.observe(e,this.options)}unobserve(e){super.disconnect();for(let[r]of this.observedNodes.entries())r===e?this.observedNodes.delete(r):this.observe(r,this.options)}disconnect(){return this.observedNodes.clear(),super.disconnect()}entries(){return this.observedNodes.entries()}},q=class n extends b.ResizeObserver{static{h(this,"ResizeObserver")}static defaultOptions=new I({box:void 0});static getOptionsKey(e){return JSON.stringify(this.defaultOptions.merge(e))}constructor(e,r={}){super(function(t){for(let o of t)e(o,this.observedNodes.reset(o.target,()=>o))},r),this.options=n.defaultOptions.merge(r),this.observedNodes=new E}observe(e){return this.observedNodes.set(e,null),super.observe(e,this.options)}unobserve(e){return this.observedNodes.delete(e),super.unobserve(e)}disconnect(){return this.observedNodes.clear(),super.disconnect()}entries(){return this.observedNodes.entries()}},U=class n extends b.IntersectionObserver{static{h(this,"IntersectionObserver")}static defaultOptions=new I({root:void 0,rootMargin:void 0,threshold:void 0});static getOptionsKey(e){let r=new b.IntersectionObserver(()=>{},e),t={root:r.root,rootMargin:r.rootMargin,threshold:r.thresholds};return t.root=u.objectId(t.root),JSON.stringify(t)}constructor(e,r={}){r=n.defaultOptions.merge(r),super(function(t){for(let o of t)o.realIntersectionRatio=o.intersectionRatio,o.realIntersectionRatio===0&&o.isIntersecting&&(o.realIntersectionRatio=Number.EPSILON),e(o,this.observedNodes.reset(o.target,()=>o))},r),this.options=r,this.observedNodes=new E}observe(e){return this.observedNodes.set(e,null),super.observe(e)}unobserve(e){return this.observedNodes.delete(e),super.unobserve(e)}disconnect(){return this.observedNodes.clear(),super.disconnect()}entries(){return this.observedNodes.entries()}},j=class extends b.CustomEvent{static{h(this,"CustomEvent")}constructor(e,r){super(e,r),this.$original=r.$original}},W=class extends DOMPoint{static{h(this,"Vector2")}constructor(e,r,t){super(e,r),this.t=t}during(e){return e.t-this.t}deltaX(e){return e.x-this.x}deltaY(e){return e.y-this.y}distance(e){return Math.sqrt(this.deltaX(e)**2+this.deltaY(e)**2)}degree(e){let r=Math.atan2(this.deltaY(e),this.deltaX(e))*(180/Math.PI)+90;return r<0&&(r+=360),r}velocity(e){return this.distance(e)/this.during(e)}};var V=class{static{h(this,"KQuery")}constructor(e){let r=this;this.API=F,this.config=new P(function(){if(u.objectIsPlain(e)&&!e.url)return e;let t={};if(e.url||e.src)for(let[o,s]of new URL(e.url||e.src).searchParams.entries())o.startsWith("kQuery-")&&(t[o.substring(7)]=s);if(e instanceof HTMLScriptElement){for(let[o,s]of u.objectToEntries(e.dataset))if(o.startsWith("kquery")){let i=o.substring(6);t[i.charAt(0).toLowerCase()+i.substring(1)]=s}}return t}()),this.config.configure({debug:!1,logLevel:0,global:"kQuery"}),globalThis[this.config.global]=this,this.logger=new y(this.config.debug,this.config.logLevel,"[kQuery]",globalThis.console)}extends(e){let r=this,t=e.name?e.name:e;this.logger.time(t);for(let[o,s]of Object.entries(e(r))){let i=Object.getOwnPropertyDescriptors(s);for(let a of Object.values(i))if(a.set){let l=a.set;(r.config.resetNative||!u.functionIsNative(l))&&(a.set=function(...c){return u.functionToCallbackable(l.bind(this),this,this)(...c)})}for(let a of o.split(","))if(a.charAt(0)==="$")for(let l of F[a]())for(let[c,d]of Object.entries(i))c!=="length"&&Object.defineProperty(globalThis[l].prototype,c,{get(){let f=u.objectToEntries(this).map(([m,p])=>p?.[c]);return f.length&&f.every(m=>u.anyIsPrimitive(m,Object,Array,FileList))?f:new x(f,c,this)},set(f){return u.objectToEntries(this).forEach(([m,p])=>{c in p&&u.functionToCallbackable(w=>p[c]=w,this,p,m)(f)})},configurable:d.configurable,enumerable:d.enumerable});else Object.defineProperties(globalThis[a].prototype,i)}this.logger.timeEnd(t)}};function _(n){let e={EventTarget:["dispatchEvent"],Element:["computedStyleMap","elementTiming","getInnerHTML","onbeforecopy","onbeforecut","onbeforepaste","onfullscreenchange","onfullscreenerror","onsearch","scrollIntoViewIfNeeded"],HTMLAnchorElement:["attributionSrc","charset","coords","name","rev","shape"],HTMLAreaElement:["noHref"],HTMLBRElement:["clear"],HTMLBodyElement:["aLink","background","bgColor","link","onafterprint","onbeforeprint","onbeforeunload","onblur","onerror","onfocus","onhashchange","onlanguagechange","onload","onmessage","onmessageerror","onoffline","ononline","onpagehide","onpageshow","onpopstate","onrejectionhandled","onresize","onscroll","onstorage","onunhandledrejection","onunload","text","vLink"],HTMLDListElement:["compact"],HTMLDirectoryElement:["*"],HTMLDivElement:["align"],HTMLElement:["attributeStyleMap","editContext","onabort","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforematch","onbeforetoggle","onbeforexrselect","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncommand","oncontentvisibilityautostatechange","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerrawupdate","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onscrollsnapchange","onscrollsnapchanging","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwheel","virtualKeyboardPolicy","writingSuggestions"],HTMLEmbedElement:["align","name"],HTMLFencedFrameElement:["*"],HTMLFontElement:["color","face","size"],HTMLFormElement:["requestAutocomplete"],HTMLFrameElement:["*"],HTMLFrameSetElement:["cols","onafterprint","onbeforeprint","onbeforeunload","onblur","onerror","onfocus","onhashchange","onlanguagechange","onload","onmessage","onmessageerror","onoffline","ononline","onpagehide","onpageshow","onpopstate","onrejectionhandled","onresize","onscroll","onstorage","onunhandledrejection","onunload","rows"],HTMLHRElement:["align","color","noShade","size","width"],HTMLHeadingElement:["align"],HTMLHtmlElement:["version"],HTMLIFrameElement:["adAuctionHeaders","align","allowPaymentRequest","credentialless","csp","featurePolicy","frameBorder","longDesc","marginHeight","marginWidth","privateToken","sharedStorageWritable","scrolling"],HTMLImageElement:["align","attributionSrc","border","fetchPriority","hspace","longDesc","name","sharedStorageWritable","vspace"],HTMLInputElement:["align","incremental","useMap","webkitdirectory"],HTMLLIElement:["type"],HTMLLegendElement:["align"],HTMLLinkElement:["charset","blocking","fetchPriority","rev","target"],HTMLMarqueeElement:["*"],HTMLMediaElement:["captureStream","controller","controlsList","disableRemotePlayback","mediaGroup","onencrypted","onwaitingforkey","remote","setSinkId","sinkId"],HTMLMenuElement:["compact"],HTMLMetaElement:["scheme"],HTMLOListElement:["compact"],HTMLObjectElement:["align","archive","border","code","codeBase","codeType","declare","hspace","standby","vspace"],HTMLParagraphElement:["align"],HTMLParamElement:["name","type","value","valueType"],HTMLPreElement:["width"],HTMLScriptElement:["attributionSrc","blocking","charset","event","fetchPriority"],HTMLStyleElement:["blocking","type"],HTMLTableCaptionElement:["align"],HTMLTableCellElement:["align","axis","bgColor","ch","chOff","height","noWrap","vAlign","width"],HTMLTableColElement:["align","ch","chOff","span","vAlign","width"],HTMLTableElement:["align","bgColor","border","cellPadding","cellSpacing","frame","rules","summary","width"],HTMLTableRowElement:["align","bgColor","ch","chOff","vAlign"],HTMLTableSectionElement:["align","ch","chOff","vAlign"],HTMLUListElement:["compact","type"],HTMLVideoElement:["cancelVideoFrameCallback","onenterpictureinpicture","onleavepictureinpicture","playsInline","requestPictureInPicture","requestVideoFrameCallback"]},r={Blob:["arrayBuffer","size","slice","stream","text","type"],Element:["after","animate","append","ariaActiveDescendantElement","ariaAtomic","ariaAutoComplete","ariaBrailleLabel","ariaBrailleRoleDescription","ariaBusy","ariaChecked","ariaColCount","ariaColIndex","ariaColIndexText","ariaColSpan","ariaControlsElements","ariaCurrent","ariaDescribedByElements","ariaDescription","ariaDetailsElements","ariaDisabled","ariaErrorMessageElements","ariaExpanded","ariaFlowToElements","ariaHasPopup","ariaHidden","ariaInvalid","ariaKeyShortcuts","ariaLabel","ariaLabelledByElements","ariaLevel","ariaLive","ariaModal","ariaMultiLine","ariaMultiSelectable","ariaOrientation","ariaPlaceholder","ariaPosInSet","ariaPressed","ariaReadOnly","ariaRelevant","ariaRequired","ariaRoleDescription","ariaRowCount","ariaRowIndex","ariaRowIndexText","ariaRowSpan","ariaSelected","ariaSetSize","ariaSort","ariaValueMax","ariaValueMin","ariaValueNow","ariaValueText","assignedSlot","attachShadow","attributes","before","checkVisibility","childElementCount","children","classList","className","clientHeight","clientLeft","clientTop","clientWidth","closest","currentCSSZoom","firstElementChild","getAnimations","getAttribute","getAttributeNS","getAttributeNames","getAttributeNode","getAttributeNodeNS","getBoundingClientRect","getClientRects","getElementsByClassName","getElementsByTagName","getElementsByTagNameNS","getHTML","hasAttribute","hasAttributeNS","hasAttributes","hasPointerCapture","id","innerHTML","insertAdjacentElement","insertAdjacentHTML","insertAdjacentText","lastElementChild","localName","matches","moveBefore","namespaceURI","nextElementSibling","outerHTML","part","prefix","prepend","previousElementSibling","querySelector","querySelectorAll","releasePointerCapture","remove","removeAttribute","removeAttributeNS","removeAttributeNode","replaceChildren","replaceWith","requestFullscreen","requestPointerLock","role","scroll","scrollBy","scrollHeight","scrollIntoView","scrollLeft","scrollTo","scrollTop","scrollWidth","setAttribute","setAttributeNS","setAttributeNode","setAttributeNodeNS","setHTMLUnsafe","setPointerCapture","shadowRoot","slot","tagName","toggleAttribute"],EventTarget:["addEventListener","removeEventListener","when"],File:["lastModified","lastModifiedDate","name"],HTMLAnchorElement:["download","hash","host","hostname","href","hreflang","origin","password","pathname","ping","port","protocol","referrerPolicy","rel","relList","search","target","text","toString","type","username"],HTMLAreaElement:["alt","coords","download","hash","host","hostname","href","origin","password","pathname","ping","port","protocol","referrerPolicy","rel","relList","search","shape","target","toString","username"],HTMLBaseElement:["href","target"],HTMLButtonElement:["checkValidity","command","commandForElement","disabled","form","formAction","formEnctype","formMethod","formNoValidate","formTarget","labels","name","popoverTargetAction","popoverTargetElement","reportValidity","setCustomValidity","type","validationMessage","validity","value","willValidate"],HTMLCanvasElement:["captureStream","getContext","height","toBlob","toDataURL","transferControlToOffscreen","width"],HTMLDataElement:["value"],HTMLDataListElement:["options"],HTMLDetailsElement:["name","open"],HTMLDialogElement:["close","closedBy","open","requestClose","returnValue","show","showModal"],HTMLElement:["accessKey","attachInternals","autocapitalize","autofocus","blur","click","contentEditable","dataset","dir","draggable","enterKeyHint","focus","hidden","hidePopover","inert","innerText","inputMode","isContentEditable","lang","nonce","offsetHeight","offsetLeft","offsetParent","offsetTop","offsetWidth","outerText","popover","showPopover","spellcheck","style","tabIndex","title","togglePopover","translate"],HTMLEmbedElement:["getSVGDocument","height","src","type","width"],HTMLFieldSetElement:["checkValidity","disabled","elements","form","name","reportValidity","setCustomValidity","type","validationMessage","validity","willValidate"],HTMLFormElement:["acceptCharset","action","autocomplete","checkValidity","elements","encoding","enctype","length","method","name","noValidate","rel","relList","reportValidity","requestSubmit","reset","submit","target"],HTMLIFrameElement:["allow","allowFullscreen","contentDocument","contentWindow","getSVGDocument","height","loading","name","referrerPolicy","sandbox","src","srcdoc","width"],HTMLImageElement:["alt","complete","crossOrigin","currentSrc","decode","decoding","height","isMap","loading","lowsrc","naturalHeight","naturalWidth","referrerPolicy","sizes","src","srcset","useMap","width","x","y"],HTMLInputElement:["accept","alt","autocomplete","checkValidity","checked","defaultChecked","defaultValue","dirName","disabled","files","form","formAction","formEnctype","formMethod","formNoValidate","formTarget","height","indeterminate","labels","list","max","maxLength","min","minLength","multiple","name","pattern","placeholder","popoverTargetAction","popoverTargetElement","readOnly","reportValidity","required","select","selectionDirection","selectionEnd","selectionStart","setCustomValidity","setRangeText","setSelectionRange","showPicker","size","src","step","stepDown","stepUp","type","validationMessage","validity","value","valueAsDate","valueAsNumber","width","willValidate"],HTMLLIElement:["value"],HTMLLabelElement:["control","form","htmlFor"],HTMLLegendElement:["form"],HTMLLinkElement:["as","crossOrigin","disabled","href","hreflang","imageSizes","imageSrcset","integrity","media","referrerPolicy","rel","relList","sheet","sizes","type"],HTMLMapElement:["areas","name"],HTMLMediaElement:["addTextTrack","autoplay","buffered","canPlayType","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","load","loop","muted","networkState","pause","paused","play","playbackRate","played","preload","preservesPitch","readyState","seekable","seeking","src","srcObject","textTracks","volume"],HTMLMetaElement:["content","httpEquiv","media","name"],HTMLMeterElement:["high","labels","low","max","min","optimum","value"],HTMLModElement:["cite","dateTime"],HTMLOListElement:["reversed","start","type"],HTMLObjectElement:["checkValidity","contentDocument","contentWindow","data","form","getSVGDocument","height","name","reportValidity","setCustomValidity","type","useMap","validationMessage","validity","width","willValidate"],HTMLOptGroupElement:["disabled","label"],HTMLOptionElement:["defaultSelected","disabled","form","index","label","selected","text","value"],HTMLOutputElement:["checkValidity","defaultValue","form","htmlFor","labels","name","reportValidity","setCustomValidity","type","validationMessage","validity","value","willValidate"],HTMLProgressElement:["labels","max","position","value"],HTMLQuoteElement:["cite"],HTMLScriptElement:["async","crossOrigin","defer","htmlFor","integrity","noModule","referrerPolicy","src","text","type"],HTMLSelectElement:["add","autocomplete","checkValidity","disabled","form","item","labels","length","multiple","name","namedItem","options","remove","reportValidity","required","selectedIndex","selectedOptions","setCustomValidity","showPicker","size","type","validationMessage","validity","value","willValidate"],HTMLSlotElement:["assign","assignedElements","assignedNodes","name"],HTMLSourceElement:["height","media","sizes","src","srcset","type","width"],HTMLStyleElement:["disabled","media","sheet"],HTMLTableCellElement:["abbr","cellIndex","colSpan","headers","rowSpan","scope"],HTMLTableElement:["caption","createCaption","createTBody","createTFoot","createTHead","deleteCaption","deleteRow","deleteTFoot","deleteTHead","insertRow","rows","tBodies","tFoot","tHead"],HTMLTableRowElement:["cells","deleteCell","insertCell","rowIndex","sectionRowIndex"],HTMLTableSectionElement:["deleteRow","insertRow","rows"],HTMLTemplateElement:["content","shadowRootClonable","shadowRootDelegatesFocus","shadowRootMode","shadowRootSerializable"],HTMLTextAreaElement:["autocomplete","checkValidity","cols","defaultValue","dirName","disabled","form","labels","maxLength","minLength","name","placeholder","readOnly","reportValidity","required","rows","select","selectionDirection","selectionEnd","selectionStart","setCustomValidity","setRangeText","setSelectionRange","textLength","type","validationMessage","validity","value","willValidate","wrap"],HTMLTimeElement:["dateTime"],HTMLTitleElement:["text"],HTMLTrackElement:["default","kind","label","readyState","src","srclang","track"],HTMLVideoElement:["disablePictureInPicture","getVideoPlaybackQuality","height","poster","videoHeight","videoWidth","width"],Node:["appendChild","baseURI","childNodes","cloneNode","compareDocumentPosition","contains","firstChild","getRootNode","hasChildNodes","insertBefore","isConnected","isDefaultNamespace","isEqualNode","isSameNode","lastChild","lookupNamespaceURI","lookupPrefix","nextSibling","nodeName","nodeType","nodeValue","normalize","ownerDocument","parentElement","parentNode","previousSibling","removeChild","replaceChild","textContent"]},t=n.config.debug?function(){let i=Object.create(null);for(let l of Object.keys(Object.getOwnPropertyDescriptors(globalThis))){if(!l.match(/^((EventTarget)|(Blob|File)|(Node|Element)|(HTML.*Element))$/))continue;let c=globalThis[l];for(let d in c.prototype)d.toUpperCase()!==d&&(d.match(/^(webkit|moz)[A-Z]/)||d.startsWith("onwebkit")||Object.prototype.hasOwnProperty.call(c.prototype,d)&&(l in e&&(e[l].includes(d)||e[l].includes("*"))||(i[c.name]=(i[c.name]??new Set).add(d))))}let a={};for(let l of Object.keys(i).toSorted())a[l]=[...i[l]].toSorted();return n.logger.debug(Object.keys(a).map(l=>`// https://developer.mozilla.org/docs/Web/API/${l}
${l}: ${JSON.stringify(a[l])},`).join(`
`)),a}():r;n.config.configure({appendNative:!0,resetNative:!0});let o=n.config.appendNative?{[[Node.name]]:{[Symbol.toPrimitive](){return this.outerHTML??this.nodeValue??null}},[[NodeList.name]]:{[Symbol.toPrimitive](){return[...this].join("")},dispatchEvent(i){let a=[];for(let l of this){let c=new i.constructor(i.type,i);a.push(l.dispatchEvent(c))}return a}},[[RadioNodeList.name]]:{get name(){return this[0]?.name},set name(i){[...this].forEach(function(a){a.name=i})}}}:{},s=h(function(i,a,l){o[i]??={},Object.defineProperty(o[i],a,l)},"defineProperty");for(let[i,a]of Object.entries(t))if(i in globalThis){let l=globalThis[i].prototype;for(let c of a){let d=Object.getOwnPropertyDescriptor(l,c);d&&(s(i,c,d),(globalThis[i]===globalThis.EventTarget||l instanceof EventTarget)&&s(k.name,c,d),(globalThis[i]===globalThis.Node||l instanceof Node)&&s(k.name,c,d),(globalThis[i]===globalThis.Blob||l instanceof Blob)&&s(G.name,c,d))}}return o}h(_,"autoproperties");function Q(n){n.config.configure({customEventPrefix:"$"}),Object.assign(n,{wellknownEvents:{click:PointerEvent},customEvents:{}});let e=new E,r=h(function(s,i){if(i==null){if(!s)throw new Error("Empty EventType is only allowed this context");return[[null,[]]]}return(""+i).trim().split(/\s+/).map(a=>a.trim().split(".")).map(([a,...l])=>{if(!s&&!a.length)throw new Error("Empty EventType is only allowed this context");return[a,l.filter(c=>c.length)]})},"eachType"),t=h(function(s){return s in n.customEvents&&(s=n.config.customEventPrefix+s),s},"internalEventName"),o=new class{constructor(){let s=h(function(i,a){let l=new Set;for(let c of i)if(c instanceof Element){c.matches(a)&&l.add(c);for(let d of c.querySelectorAll(a))l.add(d)}return l},"querySelectorThisAndAll");this.nodeSelectorCallback=new E,this.observer=new R(i=>{for(let[a,l]of this.nodeSelectorCallback.entries())for(let{selector:c,callbacks:d}of l){for(let f of s(i.addedNodes,c))n.logger.debug("Insert node to delegation emulation of ",a),d.insert(f);for(let f of s(i.removedNodes,c))n.logger.debug("Delete node to delegation emulation of ",a),d.delete(f)}},{attributes:!1,attributeOldValue:!1,characterData:!1,characterDataOldValue:!1,childList:!0,subtree:!0})}watch(s,i,a){if(i==null)a.insert(s);else{this.nodeSelectorCallback.getOrSet(s,()=>[]).push({selector:i,callbacks:a});for(let l of s.querySelectorAll(i))n.logger.debug("Initial node to delegation emulation of ",l),a.insert(l);return this.observer.observe(s)}}unwatch(s,i,a){i==null?a.delete(s):this.nodeSelectorCallback.reset(s,l=>l.filter(c=>c.selector===i&&c.callbacks===a?(n.logger.debug("Unwatch node to delegation emulation of ",s),!1):!0))}};return{[[EventTarget.name,k.name]]:{$on(s,i,a,l){typeof i=="function"&&(l=a,a=i,i=null),l=Object.assign({once:void 0,capture:void 0,passive:void 0,signal:void 0,ownself:!1,interval:void 0,throttle:void 0,debounce:void 0,leading:void 0,trailing:void 0},l),n.logger.assertInstanceOf(s,String)(),n.logger.assertInstanceOf(i,v,String)(),n.logger.assertInstanceOf(a,Function)(),n.logger.assertInstanceOf(l,Object)(),i!=null&&l.capture&&n.logger.warn("Delegation of capture phase isn't tested, so might not work well"),l.throttle&&!l.debounce&&(l.leading??=!0,l.trailing??=!1),l.debounce&&!l.throttle&&(l.leading??=!1,l.trailing??=!0);for(let[c,d]of r(!1,s)){let f={type:c,namespaces:d,selector:i,listener:a,options:l,counter:new E,collectors:[]},m;!(this instanceof Window)&&c in n.customEvents&&(m=new n.customEvents[c](this,i,l,function(g,M={},O={}){m.bubbles="bubbles"in O,O.$original??={},O.$original.$eventId??=m.eventId,O.bubbles??=(m.selector??i)!=null,O.detail??=M,g.$trigger(c,O)}),m.handlers??={},m.handlers.insert??=g=>{},m.handlers.delete??=g=>{},o.watch(this,m.selector??i,m.handlers),f.collectors.push(()=>{o.unwatch(this,m.selector??i,m.handlers),m.destructor?.(this)}));let p=new A,w=h(async g=>{if(g.$namespaces?.length&&g.$namespaces.some(T=>!f.namespaces.includes(T))||m?.eventId!==g.$original?.$eventId)return;let M=g.target,O=h(async(T,D)=>{let X=H.wait(T),J=p.reset(M,"timer",()=>X);return!((!D||J?.status==="pending")&&(J?.cancel(null),await X===null||!l.trailing))},"debounce");if(!(l.debounce!=null&&!await O(l.debounce,l.leading))){if(l.throttle!=null){if(p.getOrSet(M,"start",()=>Date.now()-(l.leading?l.throttle:0))+l.throttle>Date.now()&&!await O(l.throttle,!1))return;p.set(M,"start",Date.now())}if(g.$abort=T=>f.abortController.abort(T),f.selector==null)return f.listener.call(this,g);for(let T=M;T&&T!==this;T=T.parentElement){if(T.matches(f.selector)&&!(l.once&&f.counter.get(M)))return!f.counter.reset(M,D=>(D??0)+1)&&l.once&&m?.handlers?.delete?.(M),m&&!m.bubbles&&g.stopPropagation(),g.$delegateTarget=T,f.listener.call(this,g);if(l.ownself)break}}},"handler");f.handler=new WeakRef(w),e.getOrSet(this,()=>[]).push(f);let L=f.selector==null?l:Object.assign({},l,{once:!1});f.abortController=new AbortController,f.abortController.signal.addEventListener("abort",f.destructor),L.signal?L.signal=AbortSignal.any([L.signal,f.abortController.signal]):L.signal=f.abortController.signal,this.addEventListener(t(c),w,L),f.destructor=function(){n.logger.debug("Release of ",c,i,l),f.collectors.forEach(g=>g()),f.collectors=[]},u.objectFinalize(w,f.destructor)}return this},$off(s,i,a,l){typeof i=="function"&&(l=a,a=i,i=null),n.logger.assertInstanceOf(s,v,String)(),n.logger.assertInstanceOf(i,v,String)(),n.logger.assertInstanceOf(a,v,Function)(),n.logger.assertInstanceOf(l,v,Object)();for(let[c,d]of r(!0,s))e.reset(this,f=>(f??[]).filter(m=>c&&c!==m.type||d.length&&d.some(p=>!m.namespaces.includes(p))||i&&i!==m.selector||a&&a!==m.listener||l?.capture!==m.options.capture?!0:(this.removeEventListener(t(m.type),m.handler.deref(),m.options),m.destructor(),!1)));return this},$trigger(s,i={}){n.logger.assertInstanceOf(s,String)(),n.logger.assertInstanceOf(i,Object)();let a=!0;for(let[l,c]of r(!1,s)){let d=n.wellknownEvents[l]??j,f=new d(t(l),Object.assign({bubbles:!0,cancelable:!0,composed:!0},i));f.$namespaces=c;let m=this.dispatchEvent(f);n.logger.debug(`Event ${l} is ${m?"completed":"canceled"}`,this,f),a=a&&m}return a},$events(s,i,a=!1){n.logger.assertInstanceOf(s,v,String)(),n.logger.assertInstanceOf(i,v,Boolean)(),n.logger.assertInstanceOf(a,Boolean)();let l=e.get(this)??[];if(i)for(let c=this.parentNode;c;c=c.parentNode)for(let d of e.get(c)??[])d.selector!=null&&this.matches(d.selector)&&(d.options.once&&d.counter.get(this)||l.push(d));return l.filter(c=>{if(!c.handler.deref())return!1;for(let[d,f]of r(!0,s))if(d&&d!==c.type||f.length&&f.some(m=>!c.namespaces.includes(m)))return!1;return a===(c.options.capture??!1)})}}}}h(Q,"events");var $=new V(document.currentScript);$.logger.time("register Plugins");$.extends(_);$.extends(Q);$.logger.timeEnd("register Plugins");var ye=$;})();
/**!
 * kQuery
 *
 * @file
 * @license MIT
 * @copyright ryunosuke
 * @ignore
 */
//# sourceMappingURL=kQuery-core.min.js.map
